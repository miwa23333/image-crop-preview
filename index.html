<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>General Crop Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css">
    <style>
        :root {
            --bg-color: #1a1a1a;
            --panel-bg: #2d2d2d;
            --text-color: #e0e0e0;
            --accent: #007bff;
            --border: #555;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            margin: 0;
            display: flex;
            height: 100vh;
            overflow: hidden;
        }

        /* Left Side: Image Area */
        .workspace {
            flex: 1;
            background-color: #000;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            padding: 20px;
        }

        #image-container {
            max-width: 100%;
            max-height: 100%;
        }

        img {
            display: block;
            max-width: 100%;
        }

        /* Right Side: Controls */
        .sidebar {
            width: 350px;
            background-color: var(--panel-bg);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            box-shadow: -2px 0 10px rgba(0,0,0,0.3);
            overflow-y: auto;
        }

        h2 { margin-top: 0; font-size: 1.1rem; border-bottom: 1px solid var(--border); padding-bottom: 10px;}

        .upload-btn-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .btn {
            border: 1px solid var(--border);
            color: white;
            background-color: #3d3d3d;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            width: 100%;
            cursor: pointer;
            transition: 0.2s;
            text-align: center;
            margin-top: 5px;
        }

        .btn.primary {
            background-color: var(--accent);
            border-color: var(--accent);
        }
        
        .btn:hover { opacity: 0.9; background-color: #4d4d4d; }
        .btn.primary:hover { background-color: #0069d9; }

        .upload-btn-wrapper input[type=file] {
            font-size: 100px;
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }

        /* Result Box */
        .result-group {
            background: #383838;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
        }

        label {
            font-size: 0.75rem;
            color: #aaa;
            display: block;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        input[type="text"] {
            width: 100%;
            background: #1a1a1a;
            border: 1px solid var(--border);
            color: #0f0; /* Matrix green style */
            font-family: monospace;
            padding: 8px;
            border-radius: 4px;
            font-size: 0.9rem;
            box-sizing: border-box;
            margin-bottom: 5px;
        }

        input[type="text"]:focus {
            outline: 1px solid var(--accent);
            border-color: var(--accent);
        }

        .preview-box {
            width: 100%;
            height: 150px;
            overflow: hidden;
            background: #000;
            border: 1px solid var(--border);
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .img-preview {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
    </style>
</head>
<body>

    <div class="workspace">
        <div id="image-container">
            <img id="image" src="" alt="">
        </div>
    </div>

    <div class="sidebar">
        
        <div>
            <h2>1. Upload</h2>
            <div class="upload-btn-wrapper">
                <button class="btn primary">Select Image</button>
                <input type="file" id="file-input" accept="image/*" />
            </div>
        </div>

        <div>
            <h2>2. Coordinates</h2>
            
            <div class="result-group">
                <label>Normalized % (x1, y1, x2, y2)</label>
                <input type="text" id="output-norm" readonly onclick="this.select()">
                <button class="btn" onclick="copyToClipboard('output-norm', this)">Copy</button>
            </div>

            <div class="result-group">
                <label>Pixels (x, y, width, height)</label>
                <input type="text" id="output-pixel" readonly onclick="this.select()">
                <button class="btn" onclick="copyToClipboard('output-pixel', this)">Copy</button>
            </div>
        </div>

        <div>
            <h2>3. Preview</h2>
            <div class="preview-box">
                <div class="img-preview"></div>
            </div>
        </div>
        
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script>
        let cropper = null;
        const image = document.getElementById('image');
        const fileInput = document.getElementById('file-input');
        
        const outputNorm = document.getElementById('output-norm');
        const outputPixel = document.getElementById('output-pixel');

        // Handle Image Upload
        fileInput.addEventListener('change', (e) => {
            const files = e.target.files;
            if (files && files.length > 0) {
                const file = files[0];
                const url = URL.createObjectURL(file);
                
                image.src = url;
                
                if (cropper) {
                    cropper.destroy();
                }

                cropper = new Cropper(image, {
                    aspectRatio: NaN, 
                    viewMode: 1,
                    preview: '.img-preview',
                    crop(event) {
                        updateCoordinates(event.detail);
                    },
                });
            }
        });

        function updateCoordinates(detail) {
            // === 1. Pixel Coordinates ===
            // Cropper gives us pixels directly in detail.x, detail.y, etc.
            const pxX = Math.round(detail.x);
            const pxY = Math.round(detail.y);
            const pxW = Math.round(detail.width);
            const pxH = Math.round(detail.height);
            
            outputPixel.value = `${pxX}, ${pxY}, ${pxW}, ${pxH}`;

            // === 2. Normalized Percentages ===
            const imageData = cropper.getImageData();
            const naturalWidth = imageData.naturalWidth;
            const naturalHeight = imageData.naturalHeight;

            if (naturalWidth === 0 || naturalHeight === 0) return;

            let x1 = (detail.x / naturalWidth) * 100;
            let y1 = (detail.y / naturalHeight) * 100;
            let x2 = ((detail.x + detail.width) / naturalWidth) * 100;
            let y2 = ((detail.y + detail.height) / naturalHeight) * 100;

            // Clamp to 0-100
            x1 = Math.max(0, Math.min(100, x1));
            y1 = Math.max(0, Math.min(100, y1));
            x2 = Math.max(0, Math.min(100, x2));
            y2 = Math.max(0, Math.min(100, y2));

            // Format: "x1, y1, x2, y2"
            outputNorm.value = `${x1.toFixed(2)}, ${y1.toFixed(2)}, ${x2.toFixed(2)}, ${y2.toFixed(2)}`;
        }

        function copyToClipboard(elementId, btnElement) {
            const input = document.getElementById(elementId);
            input.select();
            document.execCommand('copy');
            
            const originalText = btnElement.innerText;
            btnElement.innerText = "Copied!";
            setTimeout(() => {
                btnElement.innerText = originalText;
            }, 1000);
        }
    </script>
</body>
</html>